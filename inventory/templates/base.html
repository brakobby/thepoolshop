{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}THE POOLsHOP{% endblock %} • THE POOLsHOP</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  {% block extra_css %}{% endblock %}

  <style>
    :root {
      --bg: #fafbff; --surface: #ffffff; --text: #1e293b; --text-muted: #64748b;
      --primary: #0ea5e9;; --border: rgba(67,97,238,0.12); --radius: 16px;
      --shadow: 0 10px 30px rgba(67,97,238,0.08); --transition: all .3s cubic-bezier(.4,0,.2,1);
    }
    .dark-mode {
      --bg: #0f172a; --surface: #1e293b; --text: #e2e8f0; --text-muted: #94a3b8;
      --primary: #8098f9; --border: rgba(128,152,249,0.16); --shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden;transition:var(--transition)}

    .topbar{height:70px;background:var(--surface);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);
      position:fixed;top:0;left:0;right:0;z-index:1000;display:flex;align-items:center;justify-content:space-between;
      padding:0 2rem;box-shadow:0 4px 20px rgba(0,0,0,.05)}
    .brand{font-weight:700;font-size:1.3rem;color:var(--primary);text-decoration:none;display:flex;align-items:center;gap:.6rem}

    .sidebar{width:260px;background:#0ea5e9;color:white;position:fixed;top:70px;left:0;bottom:0;padding:2rem 1.5rem;
      overflow-y:auto;z-index:999;transition:transform .3s ease}
    .sidebar-title{font-size:.75rem;text-transform:uppercase;letter-spacing:.1em;opacity:.8;margin:2rem 0 1rem .75rem;font-weight:600}
    .nav-link{display:flex;align-items:center;gap:.9rem;padding:.85rem 1rem;border-radius:12px;color:rgba(255,255,255,.9);
      font-weight:500;margin:.3rem 0;transition:var(--transition)}
    .nav-link:hover{background:rgba(255,255,255,.15)}
    .nav-link.active{background:rgba(255,255,255,.22);font-weight:600}

    .main{margin-left:260px;margin-top:70px;height:calc(100vh - 70px);overflow-y:auto;padding:2.5rem;background:var(--bg)}
    .main::-webkit-scrollbar{width:6px}.main::-webkit-scrollbar-thumb{background:rgba(100,116,139,.3);border-radius:3px}
    .page-title{font-size:1.8rem;font-weight:700;margin-bottom:2rem;color:var(--text)}

    @media (max-width:992px){
      .sidebar{transform:translateX(-100%)}
      .sidebar.show{transform:translateX(0)}
      .main{margin-left:0}
    }
  </style>
</head>
<body>

  <!-- Topbar -->
  <header class="topbar">
    <div>
      <button id="menuBtn" class="btn btn-sm d-lg-none"><i class="fa fa-bars"></i></button>
      <a href="{% url 'dashboard' %}" class="brand ms-3"><i class="fas fa-swimming-pool"></i> THE POOLsHOP</a>
    </div>
    <div class="d-flex align-items-center gap-3">
      <span class="text-muted small">{{ "now"|date:"d M Y" }}</span>
      <div class="dropdown">
        <a class="d-flex align-items-center text-decoration-none" data-bs-toggle="dropdown">
          <i class="fas fa-user-circle fa-lg me-2" style="color:var(--primary)"></i>
          <span class="d-none d-md-inline fw-medium">{{ user.get_full_name|default:user.username }}</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 mt-2">
          <li><a class="dropdown-item" href="#">Profile</a></li>
          <li><a class="dropdown-item" href="#">Settings</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Logout</a></li>
        </ul>
      </div>
      <button id="darkToggle" class="btn btn-sm"><i class="fas fa-moon"></i></button>
    </div>
  </header>

  <!-- Sidebar – NOW WITH CUSTOMERS SECTION -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-title">Main Menu</div>
    <nav>
      <a href="{% url 'dashboard' %}" class="nav-link {% if 'dashboard' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </a>
      <a href="{% url 'inventory_list' %}" class="nav-link {% if 'inventory' in request.resolver_match.url_name and 'customer' not in request.path %}active{% endif %}">
        <i class="fas fa-boxes"></i> Inventory
      </a>
      <a href="{% url 'low_stock_list' %}" class="nav-link {% if 'low_stock' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-exclamation-triangle"></i> Low Stock
      </a>
    </nav>

    <!-- INVOICING SECTION -->
    <div class="sidebar-title">Sales & Invoicing</div>
    <nav>
      <a href="{% url 'create_invoice' %}" class="nav-link {% if 'create_invoice' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-receipt"></i> Create Invoice
      </a>
      <a href="{% url 'invoice_list' %}" class="nav-link {% if 'invoice_list' in request.resolver_match.url_name or 'view_invoice' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-file-invoice"></i> All Invoices
      </a>
    </nav>

    <!-- CUSTOMERS SECTION – NEW & BEAUTIFUL -->
    <div class="sidebar-title">Customers</div>
    <nav>
      <a href="{% url 'customer_list' %}" class="nav-link {% if 'customer_list' in request.resolver_match.url_name or 'customer_invoices' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-users"></i> All Customers
      </a>
      <a href="{% url 'add_customer' %}" class="nav-link {% if 'add_customer' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-user-plus"></i> Add Customer
      </a>
    </nav>

    <!-- REPORTS SECTION -->
    <div class="sidebar-title">Reports & Analytics</div>
    <nav>
      <a href="{% url 'sales_report' %}" class="nav-link {% if 'sales_report' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-chart-line"></i> Sales Report
      </a>
      <a href="{% url 'stock_report' %}" class="nav-link {% if 'stock_report' in request.resolver_match.url_name %}active{% endif %}">
        <i class="fas fa-chart-pie"></i> Stock Report
      </a>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <main class="main">
    {% block content %}
    {% endblock %}
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('menuBtn')?.addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('show');
    });
    document.getElementById('darkToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const i = document.querySelector('#darkToggle i');
      i.classList.toggle('fa-moon'); i.classList.toggle('fa-sun');
    });
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>