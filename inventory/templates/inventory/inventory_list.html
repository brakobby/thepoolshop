{% extends "base.html" %}
{% load static %}

{% block title %}Inventory{% endblock %}

{% block extra_css %}
<style>
  .kpi-row {
    display: flex; flex-wrap: nowrap; gap: 1.5rem; overflow-x: auto; padding-bottom: 0.5rem;
    margin-bottom: 3rem;
  }
  .kpi-row::-webkit-scrollbar { height: 6px; }
  .kpi-row::-webkit-scrollbar-thumb { background: rgba(100,116,139,0.3); border-radius: 3px; }

  .kpi-card {
    background: var(--surface); border-radius: var(--radius); padding: 1.5rem 2rem;
    border: 1px solid var(--border); box-shadow: var(--shadow); min-width: 240px; flex: 1;
    display: flex; align-items: center; justify-content: space-between;
  }
  .kpi-value { font-size: 1.8rem; font-weight: 800; color: black; }
  .kpi-label { color: var(--text-muted); font-size: 0.95rem; font-weight: 500; }

  .table-container {
    background: var(--surface); border-radius: var(--radius); overflow: hidden;
    border: 1px solid var(--border); box-shadow: var(--shadow);
  }
  .table-container .header {
    padding: 1.5rem 2rem; border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
    background: var(--surface);
  }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="page-title">Inventory</h1>
  <a href="{% url 'add_product' %}" class="btn btn-primary px-4">
    Add Product
  </a>
</div>

<!-- HORIZONTAL KPIs — ONE CLEAN ROW -->
<div class="kpi-row">
  <div class="kpi-card">
    <div>
      <div class="kpi-label">Total Products</div>
      <div class="kpi-value">{{ products.count }}</div>
    </div>
  </div>
  <div class="kpi-card">
    <div>
      <div class="kpi-label">Items in Stock</div>
      <div class="kpi-value">{{ total_stock }}</div>
    </div>
  </div>
  <div class="kpi-card">
    <div>
      <div class="kpi-label">Low Stock Items</div>
      <div class="kpi-value text-warning">{{ low_stock_count }}</div>
    </div>
  </div>
  <div class="kpi-card">
    <div>
      <div class="kpi-label">Stock Value</div>
      <div class="kpi-value">GH₵{{ stock_value|floatformat:2 }}</div>
    </div>
  </div>
</div>

<!-- Products Table -->
<div class="table-container">
  <div class="header">
    <div class="fw-bold">Products List</div>
    <small class="text-muted">{{ products.count }} item{{ products.count|pluralize }}</small>
  </div>
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="text-uppercase small text-muted">
        <tr>
          <th>Product</th>
          <th>SKU</th>
          <th>Category</th>
          <th class="text-center">Stock</th>
          <th class="text-end">Cost</th>
          <th class="text-end">Sell</th>
          <th class="text-center">Status</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td><strong>{{ product.name }}</strong></td>
          <td><span class="text-muted">{{ product.sku }}</span></td>
          <td>{{ product.category|default:"—" }}</td>
          <td class="text-center fw-semibold">{{ product.quantity }}</td>
          <td class="text-end">GH₵{{ product.cost_price|floatformat:2 }}</td>
          <td class="text-end fw-bold text-primary">GH₵{{ product.selling_price|floatformat:2 }}</td>
          <td class="text-center">
            {% if product.quantity == 0 %}
              <span class="badge bg-danger">Out of Stock</span>
            {% elif product.quantity <= product.low_stock_threshold %}
              <span class="badge bg-warning text-dark">Low Stock</span>
            {% else %}
              <span class="badge bg-success">In Stock</span>
            {% endif %}
          </td>
          <td class="text-center">
            <div class="btn-group" role="group">
              <a href="{% url 'update_stock' product.id %}" class="btn btn-sm btn-outline-primary">Update</a>
              <a href="{% url 'edit_product' product.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
              <a href="{% url 'delete_product' product.id %}" class="btn btn-sm btn-outline-danger"
                 onclick="return confirm('Delete {{ product.name }} forever?')">
                Delete
              </a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center py-5 text-muted">
            No products found
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}