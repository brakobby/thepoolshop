{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Add Product - THE POOLsHOP</title>

  <!-- Bootstrap 5 + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --bg: #f8faff;
      --panel: #ffffff;
      --muted: #64748b;
      --primary-600: #0d6efd;
      --primary-700: #0b5ed7;
      --accent: #3b82f6;
      --card-shadow: 0 10px 30px rgba(13, 110, 253, 0.06);
      --glass: rgba(255, 255, 255, 0.85);
      --border: rgba(13, 110, 253, 0.08);
      --rounded: 14px;
      --transition: all 0.22s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Dark Mode */
    .dark-mode-enh {
      --bg: #0f172a;
      --panel: #1e293b;
      --muted: #94a3b8;
      --primary-600: #60a5fa;
      --primary-700: #3b82f6;
      --card-shadow: 0 10px 30px rgba(0,0,0,0.3);
      --glass: rgba(30,41,59,0.9);
      --border: rgba(255,255,255,0.08);
      color: #e2e8f0;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: 'Inter', 'Segoe UI', sans-serif; }
    body { background: var(--bg); color: #1e293b; overflow: hidden; transition: var(--transition); }

    /* Topbar */
    .topbar {
      height: 70px; background: var(--glass); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border); box-shadow: 0 4px 20px rgba(0,0,0,.04);
      position: sticky; top:0; z-index:1030; transition: var(--transition);
    }
    .brand { display:flex; align-items:center; gap:.6rem; font-weight:700; color:var(--primary-700); text-decoration:none; font-size:1.15rem; }
    .brand i { color:var(--primary-600); font-size:1.35rem; }

    /* Layout */
    .layout { display:flex; height:calc(100vh - 70px); overflow:hidden; }
    .sidebar {
      width:260px; min-width:260px; background:linear-gradient(180deg,#052a6b,#0b63d6);
      color:#fff; padding:1.5rem 1rem; display:flex; flex-direction:column;
      overflow:hidden; transition:width .3s ease; box-shadow:8px 0 30px rgba(5,42,107,.12);
    }
    .sidebar .nav-title { font-size:.72rem; color:rgba(255,255,255,.8); letter-spacing:.08em; margin:0 0 .8rem .8rem; font-weight:600; }
    .sidebar .nav-link {
      color:rgba(255,255,255,.92); padding:.75rem .9rem; border-radius:10px;
      display:flex; align-items:center; gap:.8rem; font-weight:600;
      transition:var(--transition); margin:.2rem .5rem;
    }
    .sidebar .nav-link:hover { background:rgba(255,255,255,.12); transform:translateX(6px); box-shadow:0 4px 12px rgba(0,0,0,.1); }
    .sidebar .nav-link.active { background:rgba(255,255,255,.18); box-shadow:inset 0 0 0 1px rgba(255,255,255,.1); font-weight:700; }

    .sidebar-collapsed { width:72px !important; min-width:72px !important; }
    .sidebar-collapsed .nav-title, .sidebar-collapsed .nav-link .label { display:none; }
    .sidebar-collapsed .nav-link { justify-content:center; padding:.75rem; }

    .main { flex:1; overflow-y:auto; overflow-x:hidden; padding:1.5rem; background:var(--bg); transition:var(--transition); }
    .main::-webkit-scrollbar { width:8px; }
    .main::-webkit-scrollbar-track { background:transparent; }
    .main::-webkit-scrollbar-thumb { background:rgba(100,116,139,.3); border-radius:4px; }
    .main::-webkit-scrollbar-thumb:hover { background:rgba(100,116,139,.5); }

    .page-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; padding-bottom:.75rem; border-bottom:1px solid var(--border); }
    .page-title { font-size:1.4rem; font-weight:700; color:var(--primary-700); display:flex; align-items:center; gap:.5rem; }

    /* Form Card */
    .form-card {
      background: var(--panel); border-radius: var(--rounded); padding: 1.5rem;
      box-shadow: var(--card-shadow); border: 1px solid var(--border);
    }
    .form-section {
      background: var(--panel); border-radius: 12px; padding: 1.25rem;
      margin-bottom: 1.25rem; border-left: 4px solid var(--primary-600);
      box-shadow: 0 4px 12px rgba(13,110,253,.08);
    }
    .form-section h5 {
      font-size: 1.1rem; font-weight: 700; color: var(--primary-700);
      display: flex; align-items: center; gap: .5rem; margin-bottom: 1rem;
    }

    .form-label { font-weight: 600; color: #1e293b; }
    .form-control, .form-select {
      border-radius: 10px; padding: .65rem 1rem; font-size: .925rem;
      border: 1px solid #ced4da; transition: var(--transition);
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--primary-600); box-shadow: 0 0 0 3px rgba(13,110,253,.15);
    }
    .form-text { font-size: .8rem; color: var(--muted); }

    .btn-action {
      padding: .65rem 1.5rem; border-radius: 10px; font-weight: 600;
    }

    @media (max-width: 992px) {
      .layout { flex-direction: column; }
      .sidebar { width: 100%; height: auto; padding: 1rem; box-shadow: none; }
    }
  </style>
</head>
<body>

  <!-- Topbar -->
  <header class="topbar">
    <div class="container-fluid h-100 d-flex align-items-center justify-content-between px-3 px-lg-4">
      <div class="d-flex align-items-center gap-3">
        <button id="sidebarToggle" class="btn btn-sm btn-outline-primary d-lg-none"><i class="fa fa-bars"></i></button>
        <a href="{% url 'dashboard' %}" class="brand"><i class="fas fa-swimming-pool"></i><span class="brand-text">THE POOLsHOP</span></a>
        <div class="small text-muted d-none d-md-inline">Add New Product</div>
      </div>

      <div class="d-flex align-items-center gap-2">
        <div class="text-muted small d-none d-md-flex align-items-center"><i class="far fa-calendar me-2"></i> {{ "now"|date:"D, d M Y" }}</div>
        <div class="dropdown">
          <button class="btn btn-light btn-sm dropdown-toggle d-flex align-items-center gap-1" data-bs-toggle="dropdown">
            <i class="fas fa-user-circle"></i><span class="d-none d-md-inline">{{ user.get_full_name|default:user.username }}</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Logout</a></li>
          </ul>
        </div>
        <button id="darkModeToggle" class="btn btn-outline-primary btn-sm"><i class="fas fa-moon"></i></button>
      </div>
    </div>
  </header>

  <!-- Layout -->
  <div class="layout">

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="nav-title">NAVIGATION</div>
      <nav class="nav flex-column flex-grow-1">
        <a class="nav-link{% if request.resolver_match.url_name == 'dashboard' %} active{% endif %}" href="{% url 'dashboard' %}">
          <i class="fas fa-tachometer-alt"></i><span class="label">Dashboard</span>
        </a>
        <a class="nav-link active" href="{% url 'inventory_list' %}">
          <i class="fas fa-boxes"></i><span class="label">Inventory</span>
        </a>
        <a class="nav-link{% if request.resolver_match.url_name == 'low_stock_list' %} active{% endif %}" href="{% url 'low_stock_list' %}">
          <i class="fas fa-exclamation-triangle"></i><span class="label">Low Stock</span>
        </a>
        <a class="nav-link{% if request.resolver_match.url_name == 'create_invoice' %} active{% endif %}" href="{% url 'create_invoice' %}">
          <i class="fas fa-receipt"></i><span class="label">Create Invoice</span>
        </a>
        <a class="nav-link{% if request.resolver_match.url_name == 'invoice_list' %} active{% endif %}" href="{% url 'invoice_list' %}">
          <i class="fas fa-file-invoice-dollar"></i><span class="label">Invoices</span>
        </a>
        <a class="nav-link{% if request.resolver_match.url_name == 'customer_list' %} active{% endif %}" href="{% url 'customer_list' %}">
          <i class="fas fa-users"></i><span class="label">Customers</span>
        </a>
        <a class="nav-link{% if request.resolver_match.url_name == 'sales_report' %} active{% endif %}" href="{% url 'sales_report' %}">
          <i class="fas fa-chart-line"></i><span class="label">Sales Report</span>
        </a>
        <a class="nav-link{% if request.resolver_match.url_name == 'stock_report' %} active{% endif %}" href="{% url 'stock_report' %}">
          <i class="fas fa-boxes-stacked"></i><span class="label">Stock Report</span>
        </a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="main">
      <section class="page-header">
        <div class="page-title"><i class="fas fa-plus-circle"></i> Add New Product</div>
        <a href="{% url 'inventory_list' %}" class="btn btn-outline-secondary btn-sm">
          <i class="fas fa-arrow-left"></i> Back
        </a>
      </section>

      <!-- Messages -->
      {% if messages %}
        <div class="mb-4">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show d-flex align-items-center" role="alert">
              <i class="fas fa-{% if 'success' in message.tags %}check-circle{% else %}exclamation-triangle{% endif %} me-2"></i>
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Form -->
      <div class="form-card">
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}

          <!-- Basic Info -->
          <div class="form-section">
            <h5><i class="fas fa-info-circle"></i> Basic Information</h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="sku" class="form-label">SKU <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="sku" name="sku" required placeholder="e.g., POOL-001" value="{{ request.POST.sku }}">
                <div class="form-text">Unique identifier</div>
              </div>
              <div class="col-md-6">
                <label for="name" class="form-label">Product Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="name" name="name" required placeholder="e.g., Chlorine Tablets" value="{{ request.POST.name }}">
              </div>
              <div class="col-md-6">
                <label for="category" class="form-label">Category</label>
                <input type="text" class="form-control" id="category" name="category" placeholder="e.g., Chemicals" value="{{ request.POST.category }}">
              </div>
              <div class="col-12">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" placeholder="Detailed product info...">{{ request.POST.description }}</textarea>
              </div>
            </div>
          </div>

          <!-- Pricing -->
          <div class="form-section">
            <h5><i class="fas fa-tag"></i> Pricing</h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="cost_price" class="form-label">Cost Price (GHS) <span class="text-danger">*</span></label>
                <input type="number" step="0.01" class="form-control" id="cost_price" name="cost_price" required value="{{ request.POST.cost_price|default:'0' }}">
                <div class="form-text">Your cost per unit</div>
              </div>
              <div class="col-md-6">
                <label for="selling_price" class="form-label">Selling Price (GHS) <span class="text-danger">*</span></label>
                <input type="number" step="0.01" class="form-control" id="selling_price" name="selling_price" required value="{{ request.POST.selling_price|default:'0' }}">
                <div class="form-text">Auto-filled with 30% margin</div>
              </div>
            </div>
          </div>

          <!-- Stock -->
          <div class="form-section">
            <h5><i class="fas fa-boxes"></i> Stock Management</h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="quantity" class="form-label">Initial Quantity <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="quantity" name="quantity" required min="0" value="{{ request.POST.quantity|default:'0' }}">
              </div>
              <div class="col-md-6">
                <label for="low_stock_threshold" class="form-label">Low Stock Alert <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="low_stock_threshold" name="low_stock_threshold" required min="1" value="{{ request.POST.low_stock_threshold|default:'5' }}">
                <div class="form-text">Notify when stock â‰¤ this</div>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="d-flex justify-content-end gap-2 mt-4">
            <a href="{% url 'inventory_list' %}" class="btn btn-outline-secondary btn-action">
              <i class="fas fa-times"></i> Cancel
            </a>
            <button type="submit" class="btn btn-primary btn-action">
              <i class="fas fa-save"></i> Add Product
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Sidebar & Dark Mode
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebarToggle');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', () => {
        sidebar.classList.toggle('sidebar-collapsed');
      });
    }

    const darkToggle = document.getElementById('darkModeToggle');
    darkToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode-enh');
      const icon = darkToggle.querySelector('i');
      icon.classList.toggle('fa-moon'); icon.classList.toggle('fa-sun');
    });

    // Auto selling price with 30% margin
    const costInput = document.getElementById('cost_price');
    const sellInput = document.getElementById('selling_price');

    costInput.addEventListener('input', () => {
      const cost = parseFloat(costInput.value) || 0;
      if (cost > 0 && (!sellInput.value || parseFloat(sellInput.value) === 0)) {
        sellInput.value = (cost * 1.3).toFixed(2);
      }
    });
  </script>
</body>
</html>